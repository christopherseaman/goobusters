# Decision Register

| ID | Date | Decision / Assumption | Rationale | Impact |
| --- | --- | --- | --- | --- |
| DR-001 | 2025-12-04 | iPad build ships with Pyto-style embedded Python runtime (or Pyodide fallback) to guarantee MD.ai SDK + ffmpeg execution. | Pythonista is aging and cannot reliably bundle native wheels; Pyto/Pyodide let us pin Python 3.11 and required deps. | Influences client packaging tasks (C1-C3) and ensures MD.ai + OpenCV run identically on iPad and desktop. |
| DR-002 | 2025-12-04 | Both client and server use the shared Python `tarfile` utility for `.tgz` mask archives instead of shelling out. | Keeps packaging logic DRY, avoids platform-specific `tar` flags, and simplifies schema validation hooks. | Drives shared task SH3 and enforces identical archive manifests across platforms for testing. |
| DR-003 | 2025-12-04 | Typed config loader (`lib/config.py`) becomes single source for `dot.env`, with scoped prefixes per role. | Prevents divergence between server/client env files and provides validation before processes start. | Required for SH1, unlocks deterministic deployments and consistent test credentials. |
| DR-004 | 2025-12-04 | Server bootstrapping requires a hydrated MD.ai dataset; we fail fast if `find_annotations_file` cannot locate exports. | Guarantees real-series metadata instead of placeholder manifests and enforces "no mocks" policy. | Ops run `uv run python3 track.py` (or MD.ai download) before launching server to generate `server_state`. |
| DR-005 | 2025-12-16 | Server endpoints trust an identification header (`X-User-Email`) from clients instead of performing MD.ai auth; MD.ai tokens are used only client→MD.ai. | Keeps the central server stateless with respect to auth, simplifies deployment, and matches the requirement that only the client talks to MD.ai. | Drives series activity tracking, last-editor fields, and conflict detection using a lightweight identity string rather than full auth on the server. |
| DR-007 | 2026-02-22 | `dot.env.defaults` added as a checked-in, non-sensitive config baseline; loader order is defaults → dot.env → role-specific → environment. Tokens/emails stay out of defaults. | Allows distributing sane defaults with builds while keeping secrets in `dot.env`/UI. Reduces risk of shipping credentials and keeps client/server aligned on shared values. | Run-time overrides remain possible via env vars; missing secrets still fail fast. |
| DR-006 | 2026-02-22 | Client no longer performs local frame extraction; all viewers consume server-produced `frames.tar` via `/proxy/api/frames`. Legacy frame endpoints were removed to enforce a single code path. | Avoids broken `context.frames` references, keeps client stateless w.r.t. frame generation, and aligns with the distributed architecture where the server owns frame derivation. | Dev utilities now preview frames from server archives; any future frame access should use the proxy API rather than local extraction. |
